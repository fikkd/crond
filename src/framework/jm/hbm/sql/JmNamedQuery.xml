<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
	
	<sql-query name="findQrtz_triggers">			
		<return-scalar column="job_name" type="string"/>
		<return-scalar column="job_group" type="string"/>
		<return-scalar column="trigger_state" type="string"/>
		<return-scalar column="start_time" type="string"/>
		<return-scalar column="end_time" type="string"/>
		<return-scalar column="pre_fire_time" type="string"/>
		<return-scalar column="next_fire_time" type="string"/>		
			select t.job_name,t.job_group
        	,decode(t.trigger_state,'ACQUIRED','正在执行','等待执行') trigger_state
        	,decode(t.start_time,0,'无',TO_CHAR(t.start_time/( 1000*60 * 60 * 24) + TO_DATE('1970-01-01 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS') )AS start_time
        	,decode(t.end_time,0,'无',TO_CHAR(t.end_time/( 1000*60 * 60 * 24) + TO_DATE('1970-01-01 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS')) AS end_time
         	,decode(t.prev_fire_time,-1,'无',TO_CHAR(t.prev_fire_time/( 1000*60 * 60 * 24) + TO_DATE('1970-01-01 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS')) AS pre_fire_time
         	,decode(t.next_fire_time,-1,'无',TO_CHAR(t.next_fire_time/( 1000*60 * 60 * 24) + TO_DATE('1970-01-01 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS')) AS next_fire_time     
     		from qrtz_triggers t where t.job_name=:job_name and t.job_group=:job_group
	</sql-query>
	
	<sql-query name="findJobList">
		<return-scalar column="id" type="string"/>
		<return-scalar column="job_name" type="string"/>
		<return-scalar column="job_group" type="string"/>
		<return-scalar column="description" type="string"/>
		<return-scalar column="isjobclass" type="int"/>
		<return-scalar column="job_class_name" type="string"/>
		<return-scalar column="job_bean_name" type="string"/>
		<return-scalar column="job_method_name" type="string"/>
		<return-scalar column="isexecuting" type="int"/>
		<return-scalar column="instance_status" type="int"/>
		<return-scalar column="qrtzcount" type="int"/>
		<return-scalar column="ordernum" type="int"/>
			select j.id, j.job_name, j.job_group, j.description, j.isjobclass, j.job_class_name, j.job_bean_name, j.job_method_name,
	 		j.isexecuting, j.instance_status,
			(select count(1) from qrtz_triggers t where t.job_name=j.job_name and t.job_group=j.job_group) qrtzcount, j.ordernum ordernum
	 		from jm_job_detail j  
	 		where ( (:queryParm='-1' or job_name like :queryParm) 
	 		or (:queryParm='-1' or job_class_name like :queryParm)
	 		or (:queryParm='-1' or job_bean_name || '.' || job_method_name like :queryParm)) 
	 		and (:instance_status=-1 or instance_status=:instance_status)
	 		and (:isexecuting=-1 or isexecuting=:isexecuting)	 
	 		order by ordernum asc,instance_status desc, job_create_time desc
	</sql-query>
</hibernate-mapping>
