(function(a){if(a.browser.msie&&(a.browser.version<9)&&!a.support.style&&Array.prototype.indexOf){delete Array.prototype.indexOf}a.extend(a.om.omCombo.prototype,{_bindEvent:function(){var h=this,g=h.options,e=h.textInput,j=h.element,b=h.dropList,d=h.expandTrigger,c=g.emptyText;var f=false,i=e.parent("span");i.mouseenter(function(){if(!g.disabled){i.addClass("om-state-hover")}}).mouseleave(function(){i.removeClass("om-state-hover")}).mousedown(function(k){k.stopPropagation()});e.focus(function(){if(f){return}f=true;a(".om-droplist").hide();i.addClass("om-state-focus");h._refeshEmptyText(c);if(!h.dataHasLoaded){if(!d.hasClass("om-loading")){h._toggleLoading("add");if(typeof(g.dataSource)=="object"){h._loadData(g.dataSource);h._toggleLoading("remove")}else{if(typeof(g.dataSource)=="string"){h._ajaxLoad(g.dataSource)}else{h.dataHasLoaded=true;h._toggleLoading("remove")}}}}if(!g.disabled&&!g.readOnly){h._showDropList()}}).blur(function(m){f=false;i.removeClass("om-state-focus");e.removeClass("om-combo-focus");if(!g.disabled&&!g.readOnly&&!g.multi){if(h.hasManualInput){h.hasManualInput=false;var o=e.val();if(o!==""){var k=a.data(j,"allInputText");var l=a.data(j,"allValues");var n=h._indexOf(k,o);if(n>-1){h._setValue(l[n])}else{if(!g.forceSelection){j.val(e.val())}else{var p=j.val();n=h._indexOf(k,p);if(n>-1){e.val(k[n])}else{e.val("")}}}}else{j.val("")}}h._refeshEmptyText(c)}}).keyup(function(k){var l=k.keyCode,m=a.om.keyCode;switch(l){case m.DOWN:h._selectNext();break;case m.UP:h._selectPrev();break;case m.ENTER:h._backfill(h.dropList.find(".om-state-hover"));break;case m.ESCAPE:b.hide();break;case m.TAB:break;default:h.hasManualInput=true;if(!g.disabled&&!g.readOnly&&g.editable&&g.autoFilter){if(window._omcomboFilterTimer){clearTimeout(window._omcomboFilterTimer)}window._omcomboFilterTimer=setTimeout(function(){if(a(document).attr("activeElement").id==e.attr("id")){b.show()}h._doFilter(e)},g.filterDelay)}}});b.mousedown(function(k){k.stopPropagation()});d.click(function(){!d.hasClass("om-loading")&&e.focus()}).mousedown(function(){!d.hasClass("om-loading")&&i.addClass("om-state-active")}).mouseup(function(){!d.hasClass("om-loading")&&i.removeClass("om-state-active")});a(document).bind("mousedown.omCombo",this.globalEvent=function(){b.hide()})},_showDropList:function(){var q=this,m=q.options,j=q.textInput,w=q.element,e=q.dropList.scrollTop(0).css("height","auto"),v,l=w.val(),b=e.find(".om-combo-list-row"),c=q._getAllOptionsBeforeFiltered().removeClass("om-helper-hidden om-state-hover");if(c.size()<=0){return}b.removeClass("om-combo-selected");if(l!==undefined&&l!==""){var d=a.data(w,"allValues");if(m.multi){var p=l.split(m.multiSeparator);for(var g=0;g<p.length;g++){var h=q._indexOf(d,p[g]);if(h>-1){a(e.find(".om-combo-list-row").get(h)).addClass("om-combo-selected")}}valueItem=p[0]}else{var h=d?q._indexOf(d,l):-1;if(h>-1){v=a(e.find(".om-combo-list-row").get(h)).addClass("om-combo-selected")}}}var f=e.parent(),s=j.parent();if(!m.listAutoWidth){f.width(s.outerWidth())}else{if(a.browser.msie&&(a.browser.version=="7.0")&&!a.support.style){f.width(e.show().outerWidth())}else{f.width(e.outerWidth())}}if(m.listMaxHeight!="auto"&&e.show().height()>m.listMaxHeight){e.height(m.listMaxHeight).css("overflow-y","auto")}var k=s.offset();var o;var x=a(window).height();var t=s.outerHeight();var u=k.top-a(window).scrollTop();var n=e.height()+4;var r=n+t;if(x-u<r&&u>n){o=k.top-n}else{o=k.top+t}f.css({left:k.left,top:o});e.show();if(v){e.scrollTop(a(v).offset().top-e.offset().top)}},_setValue:function(k){var e=this.textInput,m=this.element;var j=this;var l=true;var g=m.val();var h=this.options;if(k==g){l=false}var b=a.data(m,"allValues");var f=[],n=[];if(h.multi){n=k.split(h.multiSeparator)}else{n.push(k)}for(var c=0;c<n.length;c++){var d=b?j._indexOf(b,n[c]):-1;if(d>-1){f.push(a.data(m,"allInputText")[d])}else{if(!h.forceSelection){f.push(k)}else{m.val("");k=""}}}m.val(k);if(h.multi){e.val(f.join(h.multiSeparator))}else{e.val(f.join(""))}h.value=k;if(h.onValueChange&&l){this._trigger("onValueChange",null,e,k,g)}this._refeshEmptyText(h.emptyText)},_indexOf:function(b,e){if(a.isArray(b)&&!Array.prototype.indexOf){var d=b.length;for(var c=0;c<d;c++){if(b[c]===e){return c}}return -1}else{return b.indexOf(e)}}})})(jQuery);